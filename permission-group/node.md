# 权限节点

**权限节点**（permission node）是权限组管理模式中的一个非常重要的元素，在本篇中我们将开始深入学习权限节点。

## 何为「权限节点」

权限节点实际上属于编程中「归属表达式」的一种。接下来我们使用地理上的归属来举例。

假设我们用 `china` 来表示中国，用 `guangdong` 来表示广东，用 `shenzhen` 来表示深圳，用 `tencent` 表示深圳市南山区的腾讯滨海大厦，那么「腾讯滨海大厦」这个**实体**（Object）就可以被表示为 `china.guangdong.shenzhen.tencent`。

<iframe src="https://www.google.cn/maps/embed?pb=!1m18!1m12!1m3!1d3685.50691858712!2d113.9331017155786!3d22.522675985208462!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x3403effbe6569ed9%3A0x4d94f0d0ea54259!2z6aiw6KiK5r-x5rW35aSn5buI!5e0!3m2!1szh-TW!2scn!4v1568294716957!5m2!1szh-TW!2scn" width="600" height="450" frameborder="0" style="border:0;" allowfullscreen=""></iframe>

看到了这个，相信「权限节点」这一概念依然显得很模糊，我们逐一解释。

!> 为了便于理解，下文中的语言可能会缺乏严谨性

首先，我们需要明确的一点是——「腾讯滨海大厦」属于「深圳」属于「广东」属于「中国」（~~属于「地球」属于「太阳系」属于「银河系」属于「宇宙」属于「???」~~），这很容易理解。

那么接下来我们就用术语代入。在这里，「中国」、「广东」等可以被称作**对象**或者**实体**，即表示一个实际存在、包含任意元素的集合。例如有如下事实：

- 中国这个**对象**里包含多个**对象**：北京、上海、天津、广东；
- 广东这个**对象**里也包含多个**对象**：广州、深圳、东莞、梅州；
- 深圳这个**对象**里也包含多个**对象**：华润大厦、腾讯滨海大厦、宝安区的某小区、罗湖区的某一 711 便利店；
- ···还可以无限分下去，直到无意义而不再需要。

接下来，我们来表达从属关系。在大部分计算机编程语言中，常常使用 `.` 号来表示对象与其子元素之间的从属关系。

例如 `china.guangdong` 代表一个名为 `china` 的实体里包含一个叫做 `guangdong` 的实体；`guangdong.shenzhen.tencent` 代表一个名为 `guangdong` 的实体里包含一个叫做 `shenzhen` 的实体，而 `shenzhen` 这个实体又包含一个叫做 `tencent` 的实体。

?> **Tip:** 一般我们把一个对象所包含的其它对象称为「子对象」、「子实体」或者「元素」。

就像这样层层嵌套着来表达一个从属关系，就是「从属表达式」。

权限节点也是这样，例如 Essentials 这个插件里包含控制聊天（chat）方面的权限，那么一切有关聊天的权限均会被分类在 `essentials.chat` 这个实体下。

比如，聊天时可以使用颜色的权限就是 `essentials.chat.color`，或者再细化，聊天时可以使用蓝色的权限就是 `essentials.chat.color.blue`。

一般来讲，Spigot 等服务端会将插件的权限分配在 `<插件名>.<节点名>.<···>` 下，这就保证了各个插件之间的独立：例如某插件 `a` 含有一个叫做 `b` 的权限，那么它将会被归类为 `a.b`；而某插件 `c` 也含有一个叫做 `b` 的权限，那么它将会被归类为 `c.b`；因为 `a` 与 `c` 不同，因此即使 `b` 是一样的，也并不会导致重复或者相互影响。

这就好比美国有一个叫做 `billgates` 的人，而英国也有可能有一个叫做 `billgates` 的人，然而因为它们的国籍不一样，所以美国的 `billgates` 是 `america.billgates`，而英国的 `billgates` 则是 `britain.billgates`，它们并不相同。

!> 当然，上面这个例子举得不是很好，因为同一国家仍然会有相同姓名的人。这种情况在现实中是允许的，但是在代码世界里会导致错误。永远不会有 `america.billgates` 与 `america.billgates` 不同的情况，因此大多数解决这类情况的方法是使用 `america.billgates1` 和 `america.billgates2`。

?> **理至易明:** 「权限节点」是一种使用「从属表达式」表示一个实际存在的权限与其插件各个功能部分的关系格式方法。「权限节点」是「权限」的代词。

## 「权限」与「权限节点」的联系与不同点

一般来讲，我们把「权限」看作一种抽象的概念。例如「可以发蓝色文字的权限」就是一种**权限**（permission），而 `essentials.chat.color.blue` 则是一种**权限节点**（permission node）。

如果你看懂了上述的内容，那么你会发现这个例子中的**权限节点**和**权限**是相吻合的。即 `essentials.chat.color.blue` 就是「可以发蓝色文字的权限」。我们把这种权限与权限节点之间的关系称为**对应**（correspondence）。

!> correspondence 这个单词也许太难记忆或理解，比较类似的我们可以借助「平行」这个单词（parallel）来记忆 correspondence 的同义词 parallelism。**但是 c- 表达的意思是最准确的。**

## 权限节点的状态

既然每一个权限节点都对应着一个权限，那么就必定有一种因素控制着某一权限节点所对应的权限是否生效。通常我们把这个因素称为这个权限节点的**状态**（status）。

在计算机语言中，通常使用**布尔类型**（boolean）来表示状态，常常为真或假（true or false）。权限节点的状态也用 `true` 和 `false` 来表示。

就像从前小学、初中的英语题目一样，对的写 T，错误的写 F。因此 `true` 表示「启用」，`false` 表示「禁用」。如果一个权限不存在状态（即没有被第三方权限管理插件所改变，也没有被插件作者所预置），那么它默认为 `false`（尽管实际上并不是 `false`，但是仍然不会发挥作用）。

这样，我们可以得出**任何一个权限节点在没有被明确指定为 `true` 之前是禁用的**。而有些权限会被插件作者预置（例如 Authme 中的注册权限），因为在客观看来它们是有必要默认启用的，这种情况下不需要明确设定为 `true`，反而如果要禁用，必须明确设定为 `false`。